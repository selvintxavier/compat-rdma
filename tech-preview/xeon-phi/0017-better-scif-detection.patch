diff --git a/makefile b/makefile
index 6aaf70d..3c23862 100644
--- a/makefile
+++ b/makefile
@@ -25,6 +25,13 @@ CFLAGS += \
 	-DCOMPAT_PROJECT="\"Compat-rdma\"" \
 	-DCOMPAT_VERSION="\"$(shell cat compat_version)\"" \
 
+ifneq ($(CONFIG_INFINIBAND_SCIF),)
+SCIF_HEADER:=/usr/src/kernels/$(KVERSION)/include/
+CFLAGS += -I$(SCIF_HEADER)
+CFLAGS += \
+       $(shell if grep -R -q scif_get_node_ids $(SCIF_HEADER) 2>/dev/null; then echo -n -DHAVE_UPSTREAM_SCIF; fi)
+endif
+
 DEPMOD  = /sbin/depmod
 INSTALL_MOD_DIR ?= $(shell test -f /etc/redhat-release && echo extra/ofa_kernel || echo updates)
 
